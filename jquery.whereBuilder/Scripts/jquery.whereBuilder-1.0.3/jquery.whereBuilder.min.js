(function (n) { "use strict"; function i(t) { return n.map(t, function (n) { var t = o[n].replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/ /g, "&nbsp;"); return '<option value="' + n + '">' + t + "<\/option>" }).join("") } function s(n) { for (var r, i = 0; i < t.length; i++) if (r = t[i](n), r != null) return r; return t[0]("string") } function r(t, i) { var r = this; r.$widget = n(t); r.$table = n('<table class="table form-inline where-builder-picker"><\/table>').appendTo(r.$widget); r.columnTotal = 0; r.columns = n.extend({ "": { type: "", label: "請選擇" } }, i); n.each(i, function (n, t) { r.columnTotal++; t.handle = s(t.type) }); r.columnOption = n.map(r.columns, function (n, t) { return '<option value="' + t + '">' + n.label + "<\/option>" }).join(""); r._initField(); r.$table.find("tr").length == 0 && r.addRow(); r._initEvent() } var u = ".where-builder", f = '<span class="fa fa-plus fa-lg cursor-pointer" title="增加"><\/span>', e = n('<tr class="hover-visible"><td class="add_btn">且<\/td><td class="column"><select class="form-control input-sm"><\/select><input type="hidden" class="field" /><\/td><td class="operator"><select class="form-control input-sm"><\/select><\/td><td class="condition"><\/td><td class="delete_btn"><i class="fa fa-times fa-lg text-danger visible-target cursor-pointer" title="刪除"><\/i><\/td><\/tr>'), o = { "": "=     (等於)", "!=": "!=   (不等於)", "..": " :    (之間)", "<": "<     (小於)", "<=": "<=   (小於等於)", ">": ">     (大於)", ">=": ">=   (大於等於)", "in": "IN   (內容列表)", "!in": "!IN  (非內容列表)", "^=": "^=   (開頭內容等於)", "$=": "$=   (結尾內容等於)", "*=": "*=   (部份內容等於)" }, t = []; t.push(function (t) { t = ("" + t).toLowerCase(); return n.inArray(t, ["string", "char"]) == -1 ? null : { getOperator: function () { return i(["", "!=", "^=", "$=", "*=", "in", "!in"]) }, getControl: function () { return n('<input type="text" class="form-control input-sm" />') } } }); t.push(function (t) { t = ("" + t).toLowerCase(); return n.inArray(t, ["number", "decimal", "float", "double"]) == -1 ? null : { getOperator: function () { return i(["", "!=", "..", "<", "<=", ">", ">=", "in", "!in"]) }, getControl: function () { var t = n('<input type="text" class="form-control input-sm" />'); return t.keydown(function (t) { var i = n.trim(this.value); if (t.key == "-" && i || t.key == "." && ~i.indexOf(".")) return !1; t.altKey || t.ctrlKey || t.keyCode < 58 || t.keyCode > 90 || t.preventDefault() }), t.keyup(function () { var n = this.value.match(/(-?([0-9]*)?)(\.[0-9]*)?/); this.value = n ? n[0] : "" }), t } } }); t.push(function (t) { t = ("" + t).toLowerCase(); return n.inArray(t, ["int", "long", "short", "int32", "int64"]) == -1 ? null : { getOperator: function () { return i(["", "!=", "..", "<", "<=", ">", ">=", "in", "!in"]) }, getControl: function () { var t = n('<input type="text" class="form-control input-sm" />'); return t.keydown(function (t) { var i = n.trim(this.value); if (t.key == "-" && i || t.key == ".") return !1; t.altKey || t.ctrlKey || t.keyCode < 58 || t.keyCode > 90 || t.preventDefault() }), t.keyup(function () { var n = this.value.match(/(-?([0-9]*)?)/); this.value = n ? n[0] : "" }), t } } }); t.push(function (t) { t = ("" + t).toLowerCase(); return n.inArray(t, ["uint", "ulong", "ushort"]) == -1 ? null : { getOperator: function () { return i(["", "!=", "..", "<", "<=", ">", ">=", "in", "!in"]) }, getControl: function () { var t = n('<input type="text" class="form-control input-sm" />'); return t.keydown(function (n) { if (n.key == "." || n.key == "-") return !1; n.altKey || n.ctrlKey || n.keyCode < 58 || n.keyCode > 90 || n.preventDefault() }), t.keyup(function () { var n = this.value.match(/(([0-9]*)?)/); this.value = n ? n[0] : "" }), t } } }); t.push(function (t) { t = ("" + t).toLowerCase(); return n.inArray(t, ["date", "datetime"]) == -1 ? null : { getOperator: function () { return i(["", "!=", "..", "<", "<=", ">", ">=", "in", "!in"]) }, getControl: function () { var t = n('<input type="text" class="form-control input-sm" />'); return t.datetimepicker({ format: "yyyy-MM-dd", pickTime: !1 }), t } } }); t.push(function (t) { var r = {}, u; if (n.isPlainObject(t)) r = t; else if (n.isPlainObject(window[t])) r = window[t]; else try { r = n.parseJSON(t) } catch (f) { return console.error(t + " " + f), null } return u = n('<select class="form-control input-sm">'), n.isArray(r) ? n.each(r, function (t, i) { n("<option>", { value: i, text: i }).appendTo(u) }) : n.each(r, function (t, i) { n("<option>", { value: t, text: i }).appendTo(u) }), { getOperator: function () { return i(["", "!=", "in", "!in"]) }, getControl: function () { return u.clone() } } }); r.prototype = { _initField: function () { var t = this, i = location.search.substr(1) || "", r = i.split("#")[0].split("&") || []; n.each(r, function (n, i) { var r = i.split("="), u = decodeURIComponent(r[0]), f = decodeURIComponent(r[1].replace('+', ' ')); t.columns[u] && t.revertField(t.addRow(), u, f) }) }, _initEvent: function () { var t = this; t.$table.on("click", ".add_btn span", function () { t.addRow() }); t.$table.on("click", ".delete_btn .fa", function () { n(this).closest("tr").remove(); t.$table.find("tr").length == 0 && t.addRow(); t._checkAddBtn() }); t.$table.on("focus", ".column select", function () { var i = t.$table.find(".column select").not(this).map(function () { return n(this).val() || null }).map(function () { return '[value="' + this + '"]' }).toArray().join(); n(this).find("option").show().filter(i).hide() }); t.$table.on("change", ".column select", function () { var r = n(this).closest("tr"), e = r.find(".condition").empty(), u = r.find(".operator select").empty(), f = n(this).val(), i; (r.find(".field").attr("name", f), i = t.columns[f].handle, r.data("handle", i), i) && (e.html(i.getControl()), u.html(i.getOperator()), u.val("").trigger("change")) }); t.$table.on("change", ".operator select", function () { var u = n(this).closest("tr"), i = u.data("handle"), r; if (i) { var t = u.find(".condition"), f = t.find(":input"), e = n(this).val(); t.removeClass("more"); switch (e) { case "..": if (t.has(".input-group").length > 0) break; r = n('<div class="input-group input-group-sm">'); r.append(i.getControl()); r.append('<span class="input-group-addon">~<\/span>'); r.append(i.getControl()); t.html(r); break; case "in": case "!in": t.addClass("more"); t.has(".input-group").length > 0 ? t.html(i.getControl()) : t.find(":input").trigger("change"); break; default: if (f.length == 1) break; t.html(i.getControl()) } } }); t.$table.on("change", ".condition.more", function () { var i = n(this).closest("tr"), r = i.data("handle"), t = n(this); t.find(":input").each(function () { n(this).val().trim() || n(this).remove() }); t.append(r.getControl().val("")) }); t.$table.on("change keyup", "tr", function () { t.computeField(n(this)) }) }, _checkAddBtn: function () { var n = this, i = n.$table.find("tr").length, t = n.$table.find("tr:first-child .add_btn"); i >= n.columnTotal ? t.html("") : t.html(f) }, addRow: function () { var n = this, t = e.clone(); return t.find(".column select").html(n.columnOption), t.appendTo(n.$table), n._checkAddBtn(), t }, revertField: function (t, i, r) { var l = this, c = l.columns[i], f, e, o, s, h, u; if (c && c.handle) { if (f = c.handle, t.data("handle", f), t.find(".column select").val(i), t.find(".field").attr("name", i).val(r), e = t.find(".condition"), o = t.find(".operator select"), o.html(f.getOperator()), s = r.substr(0, 2), ~n.inArray(s, ["!=", "<=", ">=", "^=", "*=", "$="])) { o.val(s); f.getControl().val(r.substr(2)).appendTo(e); return } if (s = r.substr(0, 1), ~n.inArray(s, ["=", "<", ">"])) { o.val(s); f.getControl().val(r.substr(1)).appendTo(e); return } if (u = r.split(".."), u.length == 2) { o.val(".."); h = n('<div class="input-group input-group-sm">'); h.append(f.getControl().val(u[0])); h.append('<span class="input-group-addon">~<\/span>'); h.append(f.getControl().val(u[1])); e.html(h); return } if (u = r.split("|"), u.length > 1) { u[0].charAt(0) == "!" ? (o.val("!in"), u[0] = u[0].substr(1)) : o.val("in"); u.push(""); n.each(u, function (n, t) { f.getControl().val(t).appendTo(e) }); e.addClass("more"); return } f.getControl().val(r).appendTo(e) } }, computeField: function (t) { var r = t.find(".operator select").val(), u = t.find(".condition :input"), i = r + u.val(); switch (r) { case "..": i = u.map(function () { return n.trim(this.value) }).toArray().join(".."); break; case "in": case "!in": i = u.map(function () { return n.trim(this.value) || null }).toArray().join("|"); "!in" == r && (i = "!" + i) } t.find(".field").val(i) } }; n.fn.whereBuilder = function (t) { var f = Array.prototype.slice.call(arguments, 1), u, i; return typeof t == "string" ? (u = this.eq(0), i = u.data("WhereBuilder"), i && n.isFunction(i[t])) ? i[t].apply(i, f) : i : this.each(function () { var u = n(this), i = u.data("WhereBuilder"); i || (i = new r(this, t), u.data("WhereBuilder", i)) }) }; jQuery(function (n) { n(u).each(function () { var t = {}; n(this).find("option").each(function () { var i = n(this); t[i.val()] = { type: i.attr("type") || "string", label: i.html() || i.val() } }); n(this).parent().whereBuilder(t) }) }) })(window.jQuery);
//# sourceMappingURL=jquery.whereBuilder.min.js.map
